name: ü§ñ AI Content Generation

on:
  schedule:
    - cron: '0 12 * * 1'  # –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 12:00 UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate-content:
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: üêç Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: üì¶ Install dependencies
        run: pip install requests

      - name: üìÅ Create directories
        run: mkdir -p content/posts

      - name: ü§ñ Generate AI content
  env:
    HF_API_KEY: ${{ secrets.HF_API_KEY }}
  run: |
    echo "üöÄ –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Hugging Face API..."
    python .github/scripts/generate_post.py
    
    echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
    find content/posts/ -name "*.md" -type f -exec ls -la {} \;
          
      - name: üíæ Commit and push
        run: |
          echo "=== –ù–ê–ß–ê–õ–û –ö–û–ú–ú–ò–¢–ê ==="
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          
          echo "–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å git:"
          git status
          
          echo "–î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã:"
          git add content/posts/
          
          echo "–°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:"
          git status
          
          echo "–†–∞–∑–Ω–∏—Ü–∞ –≤ —Ñ–∞–π–ª–∞—Ö:"
          git diff --staged --name-only
          
          if ! git diff --staged --quiet; then
            echo "–ï—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
            git commit -m "ü§ñ –î–æ–±–∞–≤–ª–µ–Ω–∞ AI-—Å—Ç–∞—Ç—å—è"
            echo "–ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º—Å—è —Å remote..."
            # –°–Ω–∞—á–∞–ª–∞ pull —Å rebase
            git pull origin main --rebase
            echo "–ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
            git push origin main
            echo "‚úÖ –°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!"
          else
            echo "‚ùå –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
            echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã:"
            ls -la content/posts/
            echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ posts:"
            find content/posts/ -name "*.md" -type f
          fi
          echo "=== –ö–û–ù–ï–¶ –ö–û–ú–ú–ò–¢–ê ==="

      - name: üìã Final check
        run: |
          echo "=== –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê ==="
          echo "–í—Å–µ —Ñ–∞–π–ª—ã –≤ posts:"
          ls -la content/posts/ || echo "–ü–∞–ø–∫–∞ posts –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:"
          find . -name "*.md" -type f | head -10
