name: AI Content Generator

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * 1'  # –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 12:00 UTC

permissions:
  contents: write

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install requests

      - name: Cleanup old structure
        run: |
          echo "üßπ –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É..."
          rm -rf content/posts/posts/ 2>/dev/null || true
          rm -rf content/posts/projects/ 2>/dev/null || true

      - name: Create content directory
        run: mkdir -p content/posts

      - name: Generate AI content with Hugging Face
        env:
          HF_API_KEY: ${{ secrets.HF_API_KEY }}
        run: |
          echo "üöÄ –ó–∞–ø—É—Å–∫ —Ä–µ–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Hugging Face API..."
          
          # –°–æ–∑–¥–∞–µ–º Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
          cat > generate_article.py << 'EOF'
import requests
import os
import json
from datetime import datetime
import random

def generate_with_huggingface(prompt):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ Hugging Face API"""
    HF_API_KEY = os.getenv('HF_API_KEY')
    if not HF_API_KEY:
        return "‚ùå –û—à–∏–±–∫–∞: HF_API_KEY –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    
    API_URL = "https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2"
    headers = {"Authorization": f"Bearer {HF_API_KEY}"}
    
    payload = {
        "inputs": prompt,
        "parameters": {
            "max_new_tokens": 800,
            "temperature": 0.8,
            "do_sample": True,
            "return_full_text": False
        }
    }
    
    try:
        print(f"üß† –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞...")
        response = requests.post(API_URL, headers=headers, json=payload, timeout=120)
        
        if response.status_code == 200:
            result = response.json()
            if isinstance(result, list) and len(result) > 0:
                return result[0]['generated_text'].strip()
            else:
                return "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç API"
        else:
            return f"‚ùå –û—à–∏–±–∫–∞ API: {response.status_code} - {response.text}"
            
    except Exception as e:
        return f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {str(e)}"

def create_ai_blog_post():
    """–°–æ–∑–¥–∞–Ω–∏–µ AI-—Å—Ç–∞—Ç—å–∏ —Å —Ä–µ–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π"""
    topics = [
        "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ –≤–µ–±-–¥–∏–∑–∞–π–Ω–∞ –≤ 2024 –≥–æ–¥—É",
        "–ö–∞–∫ –Ω–∞—á–∞—Ç—å –∏–∑—É—á–∞—Ç—å JavaScript: –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã",
        "CSS Grid –∏ Flexbox: –ª—É—á—à–µ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ",
        "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –ø–æ–º–æ—â—å—é GitHub Actions",
        "–ù–µ–π—Ä–æ—Å–µ—Ç–∏ –≤ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ",
        "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–µ–±-—Å–∞–π—Ç–æ–≤",
        "PWA –ø—Ä–æ—Ç–∏–≤ –Ω–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π: —á—Ç–æ –≤—ã–±—Ä–∞—Ç—å",
        "–í–µ–±-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤"
    ]
    
    # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ç–µ–º—É
    topic = random.choice(topics)
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º—Ç –¥–ª—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏
    prompt = f"""–ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç—å—é –Ω–∞ —Ç–µ–º—É "{topic}" –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –±–ª–æ–≥–∞.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–π —è–∑—ã–∫
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π —Å—Ç–∞—Ç—å—é —Å –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ —É—Ä–æ–≤–Ω—è ## –∏ ###
- –ü—Ä–∏–≤–µ–¥–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –µ—Å–ª–∏ —É–º–µ—Å—Ç–Ω–æ
- –°–¥–µ–ª–∞–π –∑–∞–∫–ª—é—á–µ–Ω–∏–µ —Å –≤—ã–≤–æ–¥–∞–º–∏
- –í–µ—Ä–Ω–∏ –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown
- –î–ª–∏–Ω–∞: 500-800 —Å–ª–æ–≤

–°—Ç–∞—Ç—å—è:"""
    
    print(f"üìù –¢–µ–º–∞ —Å—Ç–∞—Ç—å–∏: {topic}")
    content = generate_with_huggingface(prompt)
    
    # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª
    date_str = datetime.now().strftime('%Y-%m-%d')
    slug = topic.lower().replace(' ', '-').replace(':', '').replace(',', '')[:50]
    filename = f"content/posts/{date_str}-{slug}.md"
    
    front_matter = f"""---
title: "{topic}"
date: {datetime.now().isoformat()}
draft: false
description: "–°—Ç–∞—Ç—å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –ø–æ–º–æ—â—å—é Hugging Face AI"
tags: ["ai", "–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è", "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"]
---

# {topic}

{content}

---

*–°—Ç–∞—Ç—å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é Hugging Face API*  
*–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {datetime.now().strftime('%Y-%m-%d %H:%M')}*
"""
    
    # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –Ω–µ—Ç
    os.makedirs(os.path.dirname(filename), exist_ok=True)
    
    with open(filename, 'w', encoding='utf-8') as f:
        f.write(front_matter)
    
    print(f"‚úÖ –°—Ç–∞—Ç—å—è —Å–æ–∑–¥–∞–Ω–∞: {filename}")
    print(f"üìè –†–∞–∑–º–µ—Ä —Å—Ç–∞—Ç—å–∏: {len(content)} —Å–∏–º–≤–æ–ª–æ–≤")
    return True

if __name__ == "__main__":
    create_ai_blog_post()
EOF

          # –ó–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
          python generate_article.py
          
          echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
          find content/posts/ -name "*.md" -type f -exec ls -la {} \;

      - name: Commit changes
        run: |
          echo "=== –ù–ê–ß–ê–õ–û –ö–û–ú–ú–ò–¢–ê ==="
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          
          echo "–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:"
          git status
          
          echo "–î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã:"
          git add content/posts/
          
          echo "–°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:"
          git status
          
          if ! git diff --staged --quiet; then
            echo "–ï—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞!"
            git commit -m "ü§ñ –î–æ–±–∞–≤–ª–µ–Ω–∞ AI-—Å—Ç–∞—Ç—å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Hugging Face"
            echo "–ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º—Å—è..."
            git pull origin main --rebase
            echo "–ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
            git push origin main
            echo "‚úÖ –°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏ –∑–∞–ø—É—à–µ–Ω–∞!"
          else
            echo "‚ùå –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
            echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã:"
            ls -la content/posts/ || echo "–ü–∞–ø–∫–∞ posts –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
            find content/posts/ -name "*.md" -type f
          fi
          echo "=== –ó–ê–í–ï–†–®–ï–ù–ò–ï –ö–û–ú–ú–ò–¢–ê ==="

      - name: Final verification
        run: |
          echo "=== –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê ==="
          echo "–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
          find content/posts/ -name "*.md" -type f -exec ls -la {} \; 2>/dev/null || echo "–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
          echo "–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π:"
          find content/posts/ -name "*.md" -type f | wc -l
