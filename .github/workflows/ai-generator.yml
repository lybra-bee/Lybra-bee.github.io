name: AI Content Generator

on:
  schedule:
    - cron: '0 12 * * *'  # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 12:00 UTC
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  generate-content:
    runs-on: ubuntu-latest
    timeout-minutes: 40

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Generate AI content
        env:
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫..."
          ls -la
          ls -la content/posts || mkdir -p content/posts
          ls -la assets/images/posts || mkdir -p assets/images/posts
          
          echo "üöÄ –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞..."
          python .github/scripts/generate_content.py
          
          echo "üìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:"
          find content/posts/ -name "*.md" -exec ls -la {} \; || echo "–ù–µ—Ç Markdown —Ñ–∞–π–ª–æ–≤"
          find assets/images/posts/ -name "*.jpg" -exec ls -la {} \; || echo "–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"

      - name: Commit new articles and images
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          git add content/posts/ assets/images/posts/
          git diff-index --quiet HEAD || git commit -m "üìù –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç—å–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ AI"
          git push origin HEAD

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: '0.125.7'
          extended: true

      - name: Build site
        run: |
          echo "üèóÔ∏è –°–±–æ—Ä–∫–∞ —Å–∞–π—Ç–∞ Hugo..."
          hugo --minify --logLevel info
          ls -la public/ || echo "–ü–∞–ø–∫–∞ public/ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞"

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          force_orphan: true
          keep_files: false

      - name: Verify deployment
        run: |
          echo "‚úÖ Workflow –∑–∞–≤–µ—Ä—à–µ–Ω"
          echo "üåê –°–∞–π—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: https://lybra-bee.github.io"
          echo "üïí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã"
