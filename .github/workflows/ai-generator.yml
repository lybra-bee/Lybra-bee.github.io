name: AI Content Generator

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * 1'

permissions:
  contents: write

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install requests

      - name: Cleanup old structure
        run: |
          echo "üßπ –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É..."
          rm -rf content/posts/posts/ 2>/dev/null || true
          rm -rf content/posts/projects/ 2>/dev/null || true

      - name: Create content directory
        run: mkdir -p content/posts

      - name: Generate article with AI test
        env:
          HF_API_KEY: ${{ secrets.HF_API_KEY }}
        run: |
          echo "=== –¢–ï–°–¢–ò–†–£–ï–ú API HUGGING FACE ==="
          
          # –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç API
          if [ -z "$HF_API_KEY" ]; then
            echo "‚ö†Ô∏è HF_API_KEY –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É"
            CONTENT="–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è. API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω."
          else
            echo "üîå –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API..."
            response=$(curl -s -X POST \
              -H "Authorization: Bearer $HF_API_KEY" \
              -H "Content-Type: application/json" \
              -d '{"inputs": "–ù–∞–ø–∏—à–∏ –æ–¥–∏–Ω –∞–±–∑–∞—Ü –æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö.", "parameters": {"max_new_tokens": 150}}' \
              "https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2" || echo "ERROR")
            
            if [[ "$response" == *"generated_text"* ]]; then
              echo "‚úÖ API –ø–æ–¥–∫–ª—é—á–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!"
              CONTENT=$(echo "$response" | python3 -c "import json, sys; data=json.load(sys.stdin); print(data[0]['generated_text'])" | head -3)
            else
              echo "‚ùå –û—à–∏–±–∫–∞ API, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É"
              CONTENT="–°—Ç–∞—Ç—å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. API –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ."
            fi
          fi
          
          echo "üìù –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç—å—é..."
          DATE=$(date +%Y-%m-%d)
          TIMESTAMP=$(date +%H-%M-%S)
          FILE="content/posts/${DATE}-${TIMESTAMP}-ai-article.md"
          
          # –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ç—å—é
          cat > "$FILE" << EOF
---
title: "AI –°—Ç–∞—Ç—å—è –æ—Ç ${TIMESTAMP}"
date: $(date -u +"%Y-%m-%dT%H:%M:%SZ")
draft: false
description: "–°—Ç–∞—Ç—å—è —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å AI"
tags: ["ai", "–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è", "—Ç–µ—Å—Ç"]
---

# üöÄ AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

${CONTENT}

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:** $(date +"%Y-%m-%d %H:%M:%S")
- **–ú–æ–¥–µ–ª—å:** Mistral-7B
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –£—Å–ø–µ—à–Ω–æ
- **–¢–∏–ø:** –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫

> *–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ GitHub Actions + Hugging Face API*
EOF

          echo "‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω: $FILE"
          echo "üìÑ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:"
          head -15 "$FILE"

      - name: Commit changes
        run: |
          echo "=== –ö–û–ú–ú–ò–¢ –ò–ó–ú–ï–ù–ï–ù–ò–ô ==="
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          
          git add content/posts/
          
          if ! git diff --staged --quiet; then
            git commit -m "ü§ñ –¢–µ—Å—Ç AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç $(date +%Y-%m-%d_%H-%M-%S)"
            git pull origin main --rebase
            git push origin main
            echo "‚úÖ –°—Ç–∞—Ç—å—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!"
          else
            echo "‚ùå –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
            ls -la content/posts/
          fi

      - name: Final check
        run: |
          echo "=== –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê ==="
          echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ñ–∞–π–ª—ã:"
          find content/posts/ -name "*.md" -type f -exec ls -la {} \; | tail -3
