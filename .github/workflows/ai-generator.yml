name: AI Content Generator

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * 1'

permissions:
  contents: write

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Create content directory
        run: mkdir -p content/posts

      - name: Generate article
        run: |
          echo "=== –ù–ê–ß–ê–õ–û –ì–ï–ù–ï–†–ê–¶–ò–ò –°–¢–ê–¢–¨–ò ==="
          DATE=$(date +%Y-%m-%d)
          TIMESTAMP=$(date +%H-%M-%S)
          FILE="content/posts/${DATE}-${TIMESTAMP}-ai-article.md"
          
          echo "–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª: $FILE"
          
          # –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–∞—Ç—å–∏
          echo "---" > "$FILE"
          echo "title: \"AI –°—Ç–∞—Ç—å—è –æ—Ç ${TIMESTAMP}\"" >> "$FILE"
          echo "date: $(date -u +"%Y-%m-%dT%H:%M:%SZ")" >> "$FILE"
          echo "draft: false" >> "$FILE"
          echo "description: \"–°—Ç–∞—Ç—å—è —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\"" >> "$FILE"
          echo "tags: [\"ai\", \"–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è\", \"github\"]" >> "$FILE"
          echo "---" >> "$FILE"
          echo "" >> "$FILE"
          echo "# üöÄ AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!" >> "$FILE"
          echo "" >> "$FILE"
          echo "–≠—Ç–∞ —Å—Ç–∞—Ç—å—è –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** —á–µ—Ä–µ–∑ GitHub Actions." >> "$FILE"
          echo "" >> "$FILE"
          echo "## üìä –î–µ—Ç–∞–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:" >> "$FILE"
          echo "- –î–∞—Ç–∞: $(date +%Y-%m-%d)" >> "$FILE"
          echo "- –í—Ä–µ–º—è: $(date +%H:%M:%S)" >> "$FILE" 
          echo "- Workflow: AI Content Generator" >> "$FILE"
          echo "- –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ!" >> "$FILE"
          echo "" >> "$FILE"
          echo "## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:" >> "$FILE"
          echo "1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞" >> "$FILE"
          echo "2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö" >> "$FILE"
          echo "3. –ö–æ–º–º–∏—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π" >> "$FILE"
          echo "4. –î–µ–ø–ª–æ–π –Ω–∞ GitHub Pages" >> "$FILE"
          echo "" >> "$FILE"
          echo "> –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Hugging Face API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞!" >> "$FILE"
          
          echo "‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!"
          echo "–ü—Ä–æ–≤–µ—Ä–∫–∞:"
          ls -la "$FILE"
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:"
          cat "$FILE"
          echo "=== –ó–ê–í–ï–†–®–ï–ù–ò–ï –ì–ï–ù–ï–†–ê–¶–ò–ò ==="

      - name: Commit changes
        run: |
          echo "=== –ù–ê–ß–ê–õ–û –ö–û–ú–ú–ò–¢–ê ==="
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          
          echo "–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:"
          git status
          
          echo "–î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã:"
          git add content/posts/
          
          echo "–°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:"
          git status
          
          if ! git diff --staged --quiet; then
            echo "–ï—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞!"
            git commit -m "ü§ñ –î–æ–±–∞–≤–ª–µ–Ω–∞ AI-—Å—Ç–∞—Ç—å—è –æ—Ç $(date +%Y-%m-%d_%H-%M-%S)"
            echo "–ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º—Å—è..."
            git pull origin main --rebase
            echo "–ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
            git push origin main
            echo "‚úÖ –°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏ –∑–∞–ø—É—à–µ–Ω–∞!"
          else
            echo "‚ùå –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
            echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã:"
            ls -la content/posts/ || echo "–ü–∞–ø–∫–∞ posts –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
            find . -name "*.md" -type f | head -10
          fi
          echo "=== –ó–ê–í–ï–†–®–ï–ù–ò–ï –ö–û–ú–ú–ò–¢–ê ==="

      - name: Final verification
        run: |
          echo "=== –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê ==="
          echo "–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
          find content/posts/ -name "*.md" -type f -exec ls -la {} \; 2>/dev/null || echo "–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
          echo "–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π:"
          find content/posts/ -name "*.md" -type f | wc -l
