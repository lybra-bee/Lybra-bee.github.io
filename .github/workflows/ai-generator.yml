name: AI Content Generator

on:
  schedule:
    - cron: '0 12 * * *'  # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 12:00 UTC (15:00 –ú–°–ö)
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

permissions:
  contents: write
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  generate-content:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    env:
      TZ: Europe/Moscow
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'  # –£–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

    - name: Install Python dependencies
      run: |
        echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
        python -m pip install --upgrade pip
        pip install requests

    - name: Check repository structure
      run: |
        echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
        echo "üìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏:"
        ls -la
        
        echo "üìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ .github:"
        ls -la .github/ || echo "–ü–∞–ø–∫–∞ .github –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
        
        echo "üìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ .github/scripts:"
        ls -la .github/scripts/ || echo "–ü–∞–ø–∫–∞ .github/scripts –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
        
        echo "üîé –ü–æ–∏—Å–∫ generate_content.py:"
        find . -name "generate_content.py" -type f 2>/dev/null || echo "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"

    - name: Create necessary directories
      run: |
        echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫..."
        mkdir -p content/posts
        mkdir -p assets/images/posts
        mkdir -p static/css
        mkdir -p layouts/_default
        mkdir -p layouts/partials
        echo "‚úÖ –ü–∞–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã"

    - name: Generate AI content
      env:
        OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        STABILITYAI_KEY: ${{ secrets.STABILITYAI_KEY }}
      run: |
        echo "üöÄ –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞..."
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–µ –Ω–∞–π–¥–µ–Ω
        if [ ! -f ".github/scripts/generate_content.py" ]; then
            echo "‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –≤–µ—Ä—Å–∏—é..."
            cat > simple_generate.py << 'EOF'
#!/usr/bin/env python3
import os
import random
from datetime import datetime

def generate_simple_content():
    print("üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞")
    
    topics = [
        "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –≤ 2025 –≥–æ–¥—É: –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã",
        "–ù–µ–π—Ä–æ—Å–µ—Ç–∏ –∏ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ: –±—É–¥—É—â–µ–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π",
        "–ì–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ AI –º–æ–¥–µ–ª–∏: –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
        "–≠—Ç–∏–∫–∞ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞: –≤—ã–∑–æ–≤—ã –∏ —Ä–µ—à–µ–Ω–∏—è",
        "AI –≤ –º–µ–¥–∏—Ü–∏–Ω–µ: —Ä–µ–≤–æ–ª—é—Ü–∏—è –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ"
    ]
    
    os.makedirs("content/posts", exist_ok=True)
    
    for i in range(2):
        topic = random.choice(topics)
        date = datetime.now().strftime("%Y-%m-%d")
        slug = f"ai-article-{i+1}"
        filename = f"content/posts/{date}-{slug}.md"
        
        content = f"""---
title: "{topic}"
date: {date}
tags: ["AI", "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "2025"]
draft: false
---

## –í–≤–µ–¥–µ–Ω–∏–µ
{topic} - —ç—Ç–æ –≤–∞–∂–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –º–∏—Ä–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã
- **–ò–Ω–Ω–æ–≤–∞—Ü–∏–∏**: –ù–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –º–µ–Ω—è—é—Ç –Ω–∞—à –ø–æ–¥—Ö–æ–¥ –∫ —Ä–µ—à–µ–Ω–∏—é –∑–∞–¥–∞—á
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –®–∏—Ä–æ–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ—Ç—Ä–∞—Å–ª—è—Ö
- **–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã**: –ë–æ–ª—å—à–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–µ—Ä–µ–¥–æ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
{topic} –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –æ–≥—Ä–æ–º–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –∏–Ω–Ω–æ–≤–∞—Ü–∏–π.
"""
        
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(content)
        
        print(f"‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç–∞—Ç—å—è: {filename}")
    
    print("üìù –ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ")

if __name__ == "__main__":
    generate_simple_content()
EOF
            
            python simple_generate.py
        else
            echo "üìù –ù–∞–π–¥–µ–Ω —Å–∫—Ä–∏–ø—Ç –≤ .github/scripts/generate_content.py"
            cd .github/scripts/
            python generate_content.py
            cd ../../
        fi
        
        echo "‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
        echo "üìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:"
        
        find content/ -name "*.md" -exec echo "üìÑ {}" \; 2>/dev/null || echo "‚ö†Ô∏è –°—Ç–∞—Ç—å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
        find assets/ -name "*.jpg" -o -name "*.png" -exec echo "üñºÔ∏è {}" \; 2>/dev/null || echo "‚ö†Ô∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v2
      with:
        hugo-version: '0.125.7'
        extended: true

    - name: Build Hugo site
      run: |
        echo "üèóÔ∏è –°–±–æ—Ä–∫–∞ —Å–∞–π—Ç–∞ Hugo..."
        echo "üìä –í–µ—Ä—Å–∏—è Hugo:"
        hugo version
        
        echo "üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π:"
        echo "content/: $(ls -la content/ 2>/dev/null | wc -l) —Ñ–∞–π–ª–æ–≤"
        echo "layouts/: $(ls -la layouts/ 2>/dev/null | wc -l) —Ñ–∞–π–ª–æ–≤"
        echo "static/: $(ls -la static/ 2>/dev/null | wc -l) —Ñ–∞–π–ª–æ–≤"
        
        # –°–±–æ—Ä–∫–∞
        hugo --minify --logLevel info
        
        echo "üìÅ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:"
        if [ -d "public" ]; then
            echo "‚úÖ –ü–∞–ø–∫–∞ public —Å–æ–∑–¥–∞–Ω–∞"
            echo "HTML —Ñ–∞–π–ª–æ–≤: $(find public/ -name "*.html" | wc -l)"
            echo "–†–∞–∑–º–µ—Ä: $(du -sh public/ | cut -f1)"
        else
            echo "‚ùå –ü–∞–ø–∫–∞ public –Ω–µ —Å–æ–∑–¥–∞–Ω–∞"
            exit 1
        fi

    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./public
        force_orphan: true
        keep_files: false

    - name: Verify deployment
      run: |
        echo "‚úÖ Workflow —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!"
        echo "üåê –°–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: https://lybra-bee.github.io"
        echo "üïí –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: $(date '+%Y-%m-%d %H:%M:%S %Z')"
